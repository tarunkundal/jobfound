generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                         String       @id @default(uuid()) @db.Uuid
  email                      String       @unique
  fullName                   String?
  createdAt                  DateTime     @default(now())
  updatedAt                  DateTime     @default(now()) @updatedAt
  isOnboarded                Boolean      @default(false)
  enableAiCoverLetter        Boolean      @default(false)
  filterAiMatchedJobs        Boolean      @default(false)
  enableDailyJobMatchesEmail Boolean      @default(false)
  profile                    Profile?
  resumes                    Resume?
  applications               Application?
}

model Profile {
  id                   String   @id @default(uuid()) @db.Uuid
  userId               String   @unique @db.Uuid
  fullName             String?
  phoneNumber          String?
  gender               String?
  residenceCountry     String?
  state                String?
  city                 String?
  experienceLevel      String?
  experienceYears      String?
  jobTitles            String[] @default([])
  workPreference       String[] @default([])
  skills               String[] @default([])
  currentEmployer      String?
  educationLevel       String?
  minimumSalary        String?
  additionalContext    String?
  photo_url            String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @default(now()) @updatedAt
  linkedinUrl          String?
  preferredJobLocation String?
  terms                Boolean?
  enable_auto_apply    Boolean? @default(false)
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Resume {
  id                 String                 @id @default(uuid()) @db.Uuid
  userId             String                 @unique @db.Uuid
  resume_url         String?
  raw_extracted_text String?
  uploadedAt         DateTime               @default(now())
  updatedAt          DateTime               @default(now()) @updatedAt
  resume_embeddings  Unsupported("vector(1536)")?
  user               User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_trigger_log {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String?   @db.Uuid
  email         String?
  status        String?
  error_message String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
}

model Job {
  id                 String                 @id @default(uuid()) @db.Uuid
  externalId         String?                @unique
  source             String
  title              String
  company            String
  companyUrl         String?
  location           String?
  url                String
  salary             String?
  description        String
  description_vector Unsupported("vector(1536)")?
  postedAt           DateTime
  workType           String?
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  applications       Application?

 @@unique([createdAt, id])
  @@map("jobs")
}

model Application {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String   @unique @db.Uuid
  jobId      String   @unique @db.Uuid
  appliedAt  DateTime @default(now())
  status     String
  matchScore Float?
  logData    String?
  job        Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("applications")
}
